# Whispem v2.0.0 — Test Suite
print "=== v2.0.0 Test Suite ==="

# ── Modulo ──────────────────────────────────────────────────────────
print ""
print "=== Modulo ==="
print 10 % 3        # 1
print 15 % 5        # 0
print 7 % 2         # 1

# ── FizzBuzz ────────────────────────────────────────────────────────
print ""
print "=== FizzBuzz ==="
for n in range(1, 16) {
    if n % 15 == 0 {
        print "FizzBuzz"
    } else {
        if n % 3 == 0 {
            print "Fizz"
        } else {
            if n % 5 == 0 {
                print "Buzz"
            } else {
                print n
            }
        }
    }
}

# ── Dictionaries ────────────────────────────────────────────────────
print ""
print "=== Dictionaries ==="
let person = {"name": "Emilie", "age": 26, "city": "Marseille"}
print person["name"]
print person["age"]
print person["city"]

# Dict index assignment (fixed in v2.0.0 — SET_INDEX now mutates correctly)
person["city"] = "Paris"
print person["city"]

# has_key
print has_key(person, "name")   # true
print has_key(person, "job")    # false

# keys and values
let k = keys(person)
print "Keys:"
print k

# Nested dict
let config = {
    "server": {"host": "localhost", "port": 8080},
    "debug": true
}
print config["debug"]

# Dict in function
fn greet_person(p) {
    return "Hello, " + p["name"] + " from " + p["city"] + "!"
}
let em = {"name": "Em", "city": "Marseille"}
print greet_person(em)

# ── Array index assignment ───────────────────────────────────────────
print ""
print "=== Array index assignment ==="
let arr = [10, 20, 30, 40, 50]
arr[0] = 99
arr[4] = 1
print arr[0]    # 99
print arr[4]    # 1

# ── String comparison ────────────────────────────────────────────────
print ""
print "=== String comparison ==="
let a = "apple"
let b = "banana"
if a < b {
    print "apple comes before banana"
}

# ── Bytecode VM — bare function calls (POP tested implicitly) ────────
print ""
print "=== Bare function calls ==="
fn side_effect(msg) {
    print msg
    return 42
}
side_effect("called once")
side_effect("called twice")

# ── Backwards compatibility ──────────────────────────────────────────
print ""
print "=== Backwards compatibility ==="

fn factorial(n) {
    if n <= 1 {
        return 1
    }
    return n * factorial(n - 1)
}
print factorial(10)   # 3628800

let nums = [1, 2, 3, 4, 5]
let reversed = reverse(nums)
print reversed

let sliced = slice([10, 20, 30, 40, 50], 1, 4)
print sliced

# break / continue
print ""
print "=== Break / Continue ==="
let i = 0
while i < 10 {
    let i = i + 1
    if i % 2 == 0 { continue }
    if i > 7 { break }
    print i   # 1 3 5 7
}

print ""
print "All tests passed!"
